      - name: 诊断与构建
        run: |
          echo "1. 检查项目结构..."
          find . -name "*.gradle*" -o -name "*.kts" | sort

          echo "2. 检查根目录build.gradle内容..."
          cat build.gradle

          echo "3. 临时修复：确保根目录build.gradle纯净..."
          # 以下命令会创建一个绝对干净、兼容性最好的根项目配置
          cat > build.gradle << 'EOF'
          buildscript {
              repositories { google(); mavenCentral() }
              dependencies {
                  classpath 'com.android.tools.build:gradle:7.4.2'
                  classpath 'org.jetbrains.kotlin:kotlin-gradle-plugin:1.8.21'
              }
          }
          allprojects {
              repositories { google(); mavenCentral() }
          }
          task clean(type: Delete) { delete rootProject.buildDir }
          EOF

          echo "4. 检查修复后的内容..."
          cat build.gradle

          echo "5. 开始关键构建（启用详细日志）..."
          cd app
          # 使用 clean 任务清理可能的缓存，再重新构建
          gradle clean assembleDebug --no-daemon --stacktrace 2>&1 | tail -n 200
